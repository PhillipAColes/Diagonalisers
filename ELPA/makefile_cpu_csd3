## makefile for cpu elpa to be run on Cumulus (CSD3) cluster

PLAT   = __elpa
FOR    = mpif90
CC = gcc

prefix=/usr/local/software/elpa/2019.05.001-intel-17.0.4
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include

CFLAGS = -I${includedir}/elpa_openmp-2019.05.001 -fopenmp
FCFLAGS = -O3 -ipo -xHost -traceback -g -I${includedir}/elpa_openmp-2019.05.001/modules -L/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm -I/include/intel64/lp64 -fopenmp

LIB =  -L${libdir} -lelpa_openmp  -L/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm -Wl,-rpath,/lib/intel64 -fopenmp

default:   diag$(PLAT).x

diag$(PLAT).x:  $(OBJ) diag-elpa.o
	$(FOR) $(FCFLAGS) -o diag$(PLAT).x diag-elpa.o $(LIB)

diag-elpa.o:  diag-elpa.f90 $(OBJ)
	$(FOR) -c diag-elpa.f90 $(FCFLAGS)

clean:
	rm $(OBJ) *.mod diag-elpa.o *.x

