## makefile for gpu enabled elpa to be run on wilkes2

PLAT   = __elpa
FOR    = mpiifort
CC = gcc

prefix=/usr/local/software/elpa/2019.05.001-intel-17.0.4-cuda
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include

LIB= -L${libdir} -lelpa_openmp -lcudart -lcublas  -L/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm -Wl,-rpath,/lib/intel64 -fopenmp

CFLAGS= -I${includedir}/elpa_openmp-2019.05.001 -fopenmp
FCFLAGS= -I${includedir}/elpa_openmp-2019.05.001/modules -L/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm -I/include/intel64/lp64 -fopenmp

default:   diag$(PLAT).x

diag$(PLAT).x:  $(OBJ) diag-elpa.o
	$(FOR) $(FCFLAGS) -o diag$(PLAT).x diag-elpa.o $(LIB)

diag-elpa.o:  diag-elpa.f90 $(OBJ)
	$(FOR) -c diag-elpa.f90 $(FCFLAGS)

clean:
	rm $(OBJ) *.mod diag-elpa.o *.x

